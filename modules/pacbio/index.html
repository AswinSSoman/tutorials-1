<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <meta name="author" content="Anna Syme, Torsten Seemann">
        
        <link rel="shortcut icon" href="favicon.ico">
        

	<title>PacBio assembly with SMRT portal - ABRPI Training 2016</title>

        <link href="../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../css/font-awesome-4.0.3.css" rel="stylesheet">
        <link rel="stylesheet" href="../../css/highlight.css">
        <link href="../../css/base.css" rel="stylesheet">
        <link href="../../css/sepsis.css" rel="stylesheet">

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>

            <!-- Main title -->
            <a class="navbar-brand" href="../..">ABRPI Training 2016</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            <!-- Main navigation -->
            <ul class="nav navbar-nav">
            
            
                <li >
                    <a href="../..">Home</a>
                </li>
            
            
            
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Genomics Workshop <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        
<li >
    <a href="../workshop_overview/">Workshop overview</a>
</li>

                    
                        
<li >
    <a href="../galaxy/">Starting with Galaxy</a>
</li>

                    
                        
<li >
    <a href="../data-dna/">Training dataset</a>
</li>

                    
                        
<li >
    <a href="../velvet/">Genome assembly with Velvet</a>
</li>

                    
                        
<li >
    <a href="../spades/">Genome assembly with Spades</a>
</li>

                    
                        
<li >
    <a href="../prokka/">Genome annotation</a>
</li>

                    
                        
<li >
    <a href="../snippy/">Variant finding</a>
</li>

                    
                        
<li >
    <a href="../access_data/">Public data &rarr; assembly, annotation</a>
</li>

                    
                        
<li >
    <a href="../viral_genomes/">Viral genome sequencing</a>
</li>

                    
                    </ul>
                </li>
            
            
            
                <li class="dropdown active">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Genomics <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        
<li class="active">
    <a href="./">PacBio assembly with SMRT portal</a>
</li>

                    
                        
<li >
    <a href="../cmdline_assembly/">PacBio assembly with command line tools</a>
</li>

                    
                        
<li >
    <a href="../scripts/">Bash scripts</a>
</li>

                    
                    </ul>
                </li>
            
            
            
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Transcriptomics <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        
<li >
    <a href="../dge/">Differential gene expression</a>
</li>

                    
                    </ul>
                </li>
            
            
            
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Proteomics <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        
<li >
    <a href="../xtandem/">Protein Identification</a>
</li>

                    
                    </ul>
                </li>
            
            
            
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Pathway Tools <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        
<li >
    <a href="../pathway_tools/annotation/">Pathway annotation and prediction</a>
</li>

                    
                    </ul>
                </li>
            
            
            
                <li >
                    <a href="../../about/">About</a>
                </li>
            
            
            </ul>

            <!-- Search, Navigation and Repo links -->
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                <li >
                    <a rel="next" href="../viral_genomes/">
                        <i class="fa fa-arrow-left"></i> Previous
                    </a>
                </li>
                <li >
                    <a rel="prev" href="../cmdline_assembly/">
                        Next <i class="fa fa-arrow-right"></i>
                    </a>
                </li>
                
            </ul>
        </div>
    </div>
</div>

        <div class="container">
            <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#assembly-with-pacbio-data-and-smrt-portal">Assembly with PacBio data and SMRT Portal</a></li>
        
            <li><a href="#start">Start</a></li>
        
            <li><a href="#input">Input</a></li>
        
            <li><a href="#assembly">Assembly</a></li>
        
            <li><a href="#results">Results</a></li>
        
            <li><a href="#further-polishing">Further Polishing</a></li>
        
            <li><a href="#output">Output</a></li>
        
            <li><a href="#next">Next</a></li>
        
            <li><a href="#links-to-more-information">Links to more information</a></li>
        
    
    </ul>
</div></div>
            <div class="col-md-9" role="main">

<p><br></p>
<h1 id="assembly-with-pacbio-data-and-smrt-portal">Assembly with PacBio data and SMRT Portal</h1>
<p>Keywords: de novo assembly, PacBio, PacificBiosciences, HGAP, SMRT Portal, Microbial Genomics Virtual Laboratory</p>
<p>This tutorial will show you how to assemble a bacterial genome <em>de novo</em>, using the PacBio SMRT Portal on the mGVL. We will use an analysis pipeline called HGAP, the Hierarchical Genome Assembly Process.</p>
<!-- FIXMEs:

- will SMRT portal be available on all training GVLs
- will students use existing SMRT portal registrations, or will each set up their own
- PacBio data training data to be loaded into SMRT portal(s) -->

<h2 id="start">Start</h2>
<ul>
<li>Open your mGVL dashboard.</li>
<li>You should see SMRT Portal as one of the instance services on your GVL dashboard.</li>
<li>Open up the SMRT portal web link (to the right) and register/log on.</li>
</ul>
<h2 id="input">Input</h2>
<!-- We will use a publicly available data-set of PacBio reads from the bacteria *E. coli* (reference link below).
-->

<p>We will use a dataset from a <em>Streptococcus pyogenes</em> bacteria.</p>
<p>If this has already been loaded onto SMRT portal (e.g. for use during a workshop), proceed to the next step (&ldquo;Assembly&rdquo;).</p>
<p>Otherwise:</p>
<ul>
<li>Load the PacBio data (your own, or the training dataset) onto your GVL.</li>
<li>In the SMRT Portal, go to <ss>Design Job</ss>, the top left tab.</li>
<li>Go to <ss>Import and Manage</ss>.
<img alt="smrt portal screenshot" src="./images/image03.png" /></li>
<li>Click <ss>Import SMRT cells</ss>.
<img alt="smrt portal screenshot" src="./images/image04.png" /></li>
<li>
<p>Work out where you put the data on your GVL, and make sure the file path is showing.</p>
<ul>
<li>If not, click <ss>Add</ss> and enter the file path to the data.</li>
<li>A SMRT cell is the collection of data from a particular cell in the machine. It includes .bax.h5 files.</li>
</ul>
</li>
<li>
<p>Click on the file path and then <ss>Scan</ss> to check for new data.</p>
</li>
</ul>
<h2 id="assembly">Assembly</h2>
<h3 id="hgap-process-overview">HGAP process overview</h3>
<p>We will use the Hierarchical Genome Assembly Process (HGAP). This flowchart shows the steps in the process:</p>
<p><img alt="flowchart of HGAP process" src="./images/flowchart.png" /></p>
<h3 id="set-up-job">Set up job</h3>
<ul>
<li>In the SMRT Portal, go to the top left tab, <ss>Design Job</ss>.</li>
<li>Go to <ss>Create New</ss>.</li>
<li>An <ss>Analysis</ss> window should appear. Check the box next to <ss>De novo assembly</ss>, then <ss>Next</ss>.</li>
<li>Under <ss>Job Name</ss> enter a name.</li>
<li>To the right, under <ss>Groups</ss> choose <em>all</em>.</li>
<li>Under <ss>Protocols</ss> choose <ss>RS_HGAP_Assembly.3</ss>.</li>
<li>There is an ellipsis underneath <ss>Protocols</ss> - click on the ellipsis.</li>
</ul>
<p><img alt="smrt portal screenshot" src="./images/setup.png" /></p>
<p>This brings up the settings. Click on <ss>Assembly</ss>.</p>
<ul>
<li>For <ss>Compute Minimum Seed Read Length</ss>: ensure box is ticked</li>
<li>For <ss>Number of Seed Read Chunks</ss>: enter <em>12</em></li>
<li>Change the <ss>Genome Size</ss> to an approximately correct size for the species. For <em>S. pyogenes</em>, enter 1800000.</li>
<li>For <ss>Target Coverage</ss>: enter <em>10</em></li>
<li>For <ss>Overlapper Error Rate</ss>: enter <em>0.04</em></li>
<li>Leave all other settings as they are.</li>
<li>Click <ss>Apply</ss></li>
</ul>
<p>Your protocol window should look like this:</p>
<p><img alt="smrt portal screenshot" src="./images/assembly_options.png" /></p>
<ul>
<li>
<p>Click <ss>Ok</ss>.  </p>
</li>
<li>
<p>In the <ss>SMRT Cells Available</ss> window, select the file to be used. Click on the arrow to transfer these files to the SMRT Cells in Job window.</p>
</li>
<li>You can drag the column widths of the &ldquo;Url&rdquo; column so that you can see the URLs of the file paths better.</li>
</ul>
<p><img alt="smrt portal screenshot" src="./images/smrt3.png" /></p>
<ul>
<li>Click <ss>Save</ss> (bottom right hand side).</li>
<li>Next to <ss>Save</ss>, click <ss>Start</ss>.</li>
<li>The <ss>Monitor Jobs</ss> window should open.<ul>
<li>As each step proceeds, new items will appear under the <ss>Reports</ss> and <ss>Data</ss> tabs on the left.</li>
</ul>
</li>
</ul>
<p><img alt="smrt portal screenshot" src="./images/smrt6.png" /></p>
<h3 id="inputs-and-outputs">Inputs and Outputs</h3>
<p>The connections between the names of assembly stages and outputs is not always clear. This flowchart shows how each stage of the HGAP process corresponds to protocol window names and outputs:</p>
<p><img alt="inputs and outputs" src="./images/inputs_outputs.png" /></p>
<h2 id="results">Results</h2>
<p>If the job is still running, click on the centre tab <ss>Monitor Jobs</ss>. Otherwise, click on the top right tab, <ss>View Data</ss>.</p>
<ul>
<li>Double click on the job name to open its reports.</li>
<li>Click on different <ss>Reports</ss> in the left hand panel.</li>
</ul>
<p>Things to look at:</p>
<p><strong>General: Filtering (polymerase reads)</strong></p>
<ul>
<li>number of reads post-filter</li>
<li>read length (=average)</li>
</ul>
<p><strong>General: Subread Filtering (subreads)</strong></p>
<ul>
<li>number of reads post-filter</li>
<li>read length (average)</li>
</ul>
<p><strong>Assembly: Pre-Assembly (pre-assembled reads)</strong></p>
<ul>
<li>length cutoff (the computed minimum seed read length)</li>
<li>read length (average)</li>
</ul>
<p><strong>Assembly: Corrections</strong></p>
<p>Consensus calling results:</p>
<ul>
<li>Consensus concordance should be &gt; 99%.</li>
</ul>
<p>Graph: corrections across reference:</p>
<ul>
<li>With the first run of polishing, we expect a lot of corrections but they should be randomly distributed.</li>
</ul>
<p><strong>Assembly: Top Corrections</strong></p>
<p>This is a list of all the corrections made.</p>
<ul>
<li>If more than two corrections (with confidence &gt; 50), repeat polishing (see next section &ldquo;Further polishing&rdquo;).</li>
</ul>
<p><strong>Resequencing: Coverage</strong></p>
<p>Coverage across reference:</p>
<ul>
<li>discard contigs &lt;20X coverage</li>
<li>others should have fairly consistent coverage.</li>
<li>spikes could be collapsed repeats.</li>
<li>valleys could be mis-assembly - e.g. draft assembly was incorrect and so remapped reads didn&rsquo;t support this part of the assembly.</li>
</ul>
<p>Graph: Depth of Coverage:</p>
<p><em>Number</em> of reference regions vs coverage. <!-- Should be roughly normal? --></p>
<p><strong>Assembly: Polished Assembly</strong></p>
<ul>
<li>number of contigs</li>
<li>max contig length</li>
<li>graph: confidence vs depth. multi-copy plasmids may have higher coverage.</li>
</ul>
<h2 id="further-polishing">Further Polishing</h2>
<p>During polishing, raw reads are used to correct the assembly.
During HGAP, the assembly was polished once but may need further corrections.</p>
<ul>
<li>From the previous step, Go to <ss>Data &rarr; Assembly &rarr; Polished Assembly</ss> and download the FASTA file by clicking on it.<ul>
<li>Unzip the .gz file</li>
</ul>
</li>
<li>Go to <ss>Design Job &rarr; Import and Manage</ss> and click <ss>New</ss> on the bottom right hand side. Then, select that FASTA assembly file to upload.<ul>
<li>creates a new reference.</li>
</ul>
</li>
<li>Go to <ss>Design Job &rarr; Create New</ss><ul>
<li>choose reference-based</li>
<li>Select protocol: RS_Resequencing.1</li>
<li>Leave all settings.</li>
<li>Select your reference from the drop down menu.</li>
<li>Click <ss>Save</ss> and <ss>Start</ss>.</li>
</ul>
</li>
<li>Examine the output assembly and repeat if necessary (e.g. if &gt; 2 corrections with &gt;50 confidence).</li>
</ul>
<h2 id="output">Output</h2>
<p>The polished assembly as a FASTA file.</p>
<ul>
<li>download to local computer; or</li>
<li>open file in (GVL) Galaxy; or</li>
<li>open file in GVL command line: and perform further analysis.</li>
</ul>
<h2 id="next">Next</h2>
<p>Further options:</p>
<ul>
<li>correct with Illumina reads</li>
<li>circularise</li>
<li>annotate</li>
</ul>
<h2 id="links-to-more-information">Links to more information</h2>
<p><a href="https://github.com/PacificBiosciences/DevNet/wiki/E.-coli-Bacterial-Assembly">PacBio <em>E. coli</em> data set</a></p>
<p><a href="https://github.com/PacificBiosciences/Bioinformatics-Training/wiki/HGAP">HGAP overview</a></p>
<p><a href="http://files.pacb.com/software/smrtanalysis/2.3.0/doc/smrtportal/help/Webhelp/SMRT_Portal.htm">A full ist of reports and terminology</a></p>
<p><a href="http://www.pacb.com/training/BacterialAssemblyandEpigeneticAnalysis/story.html">Video overview of HGAP on SMRT portal</a></p>
<p><a href="http://files.pacb.com/Training/IntroductiontoSMRTbellTemplatePreparation/story_content/external_files/Introduction%20to%20SMRTbell%E2%84%A2%20Template%20Preparation.pdf">More about the SMRT bell template</a></p></div>
        </div>

        <footer class="col-md-12">
            <hr>
            
            <center>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</center>
        </footer>

        <script src="../../js/jquery-1.10.2.min.js"></script>
        <script src="../../js/bootstrap-3.0.3.min.js"></script>
        <script src="../../js/highlight.pack.js"></script>
        <script>var base_url = '../..';</script>
        <script data-main="../../mkdocs/js/search.js" src="../../mkdocs/js/require.js"></script>
        <script src="../../js/base.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                        <h4 class="modal-title" id="exampleModalLabel">Search</h4>
                    </div>
                    <div class="modal-body">
                        <p>
                            From here you can search these documents. Enter
                            your search terms below.
                        </p>
                        <form role="form">
                            <div class="form-group">
                                <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                            </div>
                        </form>
                        <div id="mkdocs-search-results"></div>
                    </div>
                    <div class="modal-footer">
                    </div>
                </div>
            </div>
        </div>
    </body>
</html>